# Test configuration for the complex microservices Helm chart
# This file contains test-specific values for orchestrator testing

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Application configuration
app:
  name: "microservices-test"
  namespace: "microservices-test"
  environment: "testing"

# Frontend configuration for testing
frontend:
  enabled: true
  name: "frontend"
  image:
    repository: "nginx"
    tag: "1.21-alpine"
    pullPolicy: "IfNotPresent"
  replicas: 2
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
    hosts:
      - host: "frontend.local"
        paths:
          - path: /
            pathType: Prefix

# Backend configuration for testing
backend:
  enabled: true
  name: "backend-api"
  image:
    repository: "node"
    tag: "18-alpine"
    pullPolicy: "IfNotPresent"
  replicas: 2
  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  env:
    - name: DATABASE_URL
      value: "postgresql://postgres:postgres@postgresql:5432/appdb"
    - name: REDIS_URL
      value: "redis://redis:6379"
    - name: RABBITMQ_URL
      value: "amqp://user:password@rabbitmq:5672"
    - name: NODE_ENV
      value: "testing"

# Worker configuration for testing
worker:
  enabled: true
  name: "worker"
  image:
    repository: "python"
    tag: "3.11-alpine"
    pullPolicy: "IfNotPresent"
  replicas: 1
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  env:
    - name: RABBITMQ_URL
      value: "amqp://user:password@rabbitmq:5672"
    - name: REDIS_URL
      value: "redis://redis:6379"

# Monitoring configuration for testing
monitoring:
  enabled: true
  name: "prometheus"
  image:
    repository: "prom/prometheus"
    tag: "v2.45.0"
    pullPolicy: "IfNotPresent"
  replicas: 1
  service:
    type: ClusterIP
    port: 9090
    targetPort: 9090
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "200m"

# Database configuration for testing
postgresql:
  enabled: true
  auth:
    postgresPassword: "postgres"
    database: "appdb"
  primary:
    persistence:
      enabled: true
      size: 2Gi
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"

# Redis configuration for testing
redis:
  enabled: true
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "128Mi"
        cpu: "100m"

# RabbitMQ configuration for testing
rabbitmq:
  enabled: true
  auth:
    username: "user"
    password: "password"
  persistence:
    enabled: true
    size: 2Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Network policies for testing
networkPolicies:
  enabled: true
  defaultDeny: true

# Ingress configuration for testing
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
  hosts:
    - host: "api.local"
      paths:
        - path: /api
          pathType: Prefix
          service: backend
    - host: "monitoring.local"
      paths:
        - path: /
          pathType: Prefix
          service: monitoring

# NodePort Services for testing
nodePort:
  enabled: true
  frontend:
    port: 30080
  backend:
    port: 30081
  monitoring:
    port: 30082
  postgresql:
    port: 30083
  redis:
    port: 30084
  rabbitmq:
    amqpPort: 30085
    managementPort: 30086
    metricsPort: 30087

# Service accounts and RBAC for testing
serviceAccount:
  create: true
  name: "microservices-sa"
  annotations: {}

rbac:
  create: true

# ConfigMaps and Secrets for testing
configMaps:
  appConfig:
    data:
      LOG_LEVEL: "debug"
      MAX_CONNECTIONS: "50"
      TIMEOUT: "15s"

secrets:
  appSecrets:
    data:
      JWT_SECRET: "test-jwt-secret"
      API_KEY: "test-api-key"
